(function(){const t="aud_sv",e="aud_fv",s=".audubon.org",i={keys:{pagePath:"pp",subdomain:"sd",sessionCount:"sc",ipAddress:"ip",referrer:"ref",firstVisitDate:"fvd",cta:"cta",clickPath:"cp"},urlParams:{utm_source:"src",utm_medium:"med",utm_campaign:"cmp",utm_content:"cnt",utm_term:"trm",ms:"ms",aud_cta:"cta",aud_path:"path"},browser:{Chrome:"Ch",Firefox:"FF",Safari:"SF",Edge:"Ed",Opera:"Op",IE:"IE"},sources:{Google:"G",Facebook:"Fb",Twitter:"Tw",LinkedIn:"Li"},mediums:{email:"em",social:"so"}},a=Object.keys(i.urlParams),n={initialized:!1,cookies:null,sessionData:{},firstVisitData:{},initialize(){this.initialized||(this.cookies=this.getCookies(),this.sessionData=this.cookies[t]||{},this.firstVisitData=this.cookies[e]||{},this.initialized=!0)},getCookies:()=>document.cookie.split("; ").reduce(((t,e)=>{const s=e.split("="),i=s[0],a=s.slice(1).join("=");try{t[i]=JSON.parse(decodeURIComponent(a))}catch(e){t[i]=a}return t}),{}),getCookieValue(t){return this.cookies[t]||null},setCookieValue(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";const a=encodeURIComponent(JSON.stringify(e));let n="".concat(t,"=").concat(a,";path=/");s&&(n+=";expires=".concat(s)),i&&(n+=";domain=".concat(i)),document.cookie=n},setSessionData(e){this.initialize(),this.sessionData={...this.sessionData,...e};const i=this.getAbbreviatedData(this.sessionData);this.setCookieValue(t,i,"",s)},setFirstVisitData(t){this.initialize(),this.firstVisitData={...this.firstVisitData,...t};const i=this.getAbbreviatedData(this.firstVisitData);this.setCookieValue(e,i,"Thu, 31 Dec 9999 23:59:59 GMT",s)},getAbbreviatedData(t){const e={};for(const s in t)if(t.hasOwnProperty(s)&&null!==t[s]){const a=i.keys[s]||s;if("urlParams"===s){const n=t[s],o={};for(const t in n)i.urlParams[t]&&(o[t]=n[t]);e[a]=o}else e[a]=t[s]}return e},getAbbreviatedValue(t){for(const e of Object.values(i)){const s=Object.keys(e).find((s=>e[s]===t));if(s)return s}return t}},o=function(){if(n.sessionData.browser)return n.sessionData.browser;const t=window.navigator.userAgent,e=[{name:"Chrome",pattern:/(Chrome|CriOS)\/([\d.]+)/},{name:"Firefox",pattern:/(Firefox|FxiOS)\/([\d.]+)/},{name:"Safari",pattern:/Version\/([\d.]+)(?=.*Safari)/},{name:"Edge",pattern:/Edge\/([\d.]+)/},{name:"Opera",pattern:/(Opera|OPR)\/([\d.]+)/},{name:"IE",pattern:/(MSIE|Trident\/\d+.\d+|Edge\/\d+.\d+)/}];for(const{name:s,pattern:a}of e)if(a.exec(t))return i.browser[s];return null},r=function(){return n.sessionData.pagePath?n.sessionData.pagePath:window.location.pathname},c=function(){return n.sessionData.subdomain?n.sessionData.subdomain:window.location.hostname.split(".")[0]},u=function(){const t=n.sessionData;return t.sessionCount?t.sessionCount:(t.sessionCount||0)+1},d=function(){if(n.sessionData.urlParams)return n.sessionData.urlParams;const t=new URLSearchParams(window.location.search),e={};return a.forEach((s=>{const i=t.get(s);null!==i&&(e[s]=i)})),e},l=function(){return new URLSearchParams(window.location.search).get("aud_path")||null},f=function(){return new URLSearchParams(window.location.search).get("aud_cta")||null},h=async function(){if(n.sessionData.ipAddress)return n.sessionData.ipAddress;try{const t=await fetch("https://api.ipify.org?format=json"),e=await t.json();return e.ip}catch(t){return console.error("Error fetching IP address:",t),null}},m=function(){return document.referrer?document.referrer:null},p=function(){if(n.sessionData.firstVisitDate)return n.sessionData.firstVisitDate;const t=new Date;return"".concat(String(t.getFullYear()).slice(-2)).concat(String(t.getMonth()+1).padStart(2,"0")).concat(String(t.getDate()).padStart(2,"0"))};return{getSession:function(t){n.initialize();const e=n.sessionData,s=i.keys[t]||t;return e[t]||e[s]||null},getFirstVisit:function(t){n.initialize();const e=n.firstVisitData,s=i.keys[t]||t;return e[t]||e[s]||null},track:async function(){n.initialize();const s=n.getCookieValue(t),i=n.getCookieValue(e),a=l(),D=f();if(a||D){const t={};a&&(t.clickPath=a),D&&(t.cta=D),n.setSessionData(t)}if(!s){const t={sessionCount:u(),browser:o(),pagePath:r(),subdomain:c(),urlParams:d(),referrer:m()};i||(t.firstVisitDate=p(),n.setFirstVisitData(t));const e=await h();e&&(t.ipAddress=e),n.setSessionData(t)}}}})().track();